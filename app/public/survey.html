<!DOCTYPE html>
<html>
<head>
	<title>Friend Finder</title>
	<!-- Latest compiled and minified CSS & JS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
	<script src="https://code.jquery.com/jquery.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
</head>
<body>
	<div class="container">
		<h1>Survey</h1>
		<hr>
		<form>
			<h2>About You</h2>
			<h4>Name (Required)</h4>
			<input type="text" name="" id="name" class="form-control" required="">
			<h4>Link to photo (required)</h4>
			<input type="text" name="" id="photo" class="form-control" required="">
			<hr>

			<h2>Question 1</h2>
			<h4>question text 1</h4>
			<input type="radio" name="question-1" value="1" checked> 1 <br>
			<input type="radio" name="question-1" value="2"> 2 <br>
			<input type="radio" name="question-1" value="3"> 3 <br>
			<input type="radio" name="question-1" value="4"> 4 <br>
			<input type="radio" name="question-1" value="5"> 5 <br>

			<h2>Question 2</h2>
			<h4>question text 2</h4>
			<input type="radio" name="question-2" value="1" checked> 1 <br>
			<input type="radio" name="question-2" value="2"> 2 <br>
			<input type="radio" name="question-2" value="3"> 3 <br>
			<input type="radio" name="question-2" value="4"> 4 <br>
			<input type="radio" name="question-2" value="5"> 5 <br>

			<h2>Question 3</h2>
			<h4>question text 3</h4>
			<input type="radio" name="question-3" value="1" checked> 1 <br>
			<input type="radio" name="question-3" value="2"> 2 <br>
			<input type="radio" name="question-3" value="3"> 3 <br>
			<input type="radio" name="question-3" value="4"> 4 <br>
			<input type="radio" name="question-3" value="5"> 5 <br>

			<h2>Question 4</h2>
			<h4>question text 4</h4>
			<input type="radio" name="question-4" value="1" checked> 1 <br>
			<input type="radio" name="question-4" value="2"> 2 <br>
			<input type="radio" name="question-4" value="3"> 3 <br>
			<input type="radio" name="question-4" value="4"> 4 <br>
			<input type="radio" name="question-4" value="5"> 5 <br>

			<h2>Question 5</h2>
			<h4>question text 5</h4>
			<input type="radio" name="question-5" value="1" checked> 1 <br>
			<input type="radio" name="question-5" value="2"> 2 <br>
			<input type="radio" name="question-5" value="3"> 3 <br>
			<input type="radio" name="question-5" value="4"> 4 <br>
			<input type="radio" name="question-5" value="5"> 5 <br>

			<h2>Question 6</h2>
			<h4>question text 6</h4>
			<input type="radio" name="question-6" value="1" checked> 1 <br>
			<input type="radio" name="question-6" value="2"> 2 <br>
			<input type="radio" name="question-6" value="3"> 3 <br>
			<input type="radio" name="question-6" value="4"> 4 <br>
			<input type="radio" name="question-6" value="5"> 5 <br>

			<h2>Question 7</h2>
			<h4>question text 7</h4>
			<input type="radio" name="question-7" value="1" checked> 1 <br>
			<input type="radio" name="question-7" value="2"> 2 <br>
			<input type="radio" name="question-7" value="3"> 3 <br>
			<input type="radio" name="question-7" value="4"> 4 <br>
			<input type="radio" name="question-7" value="5"> 5 <br>

			<h2>Question 8</h2>
			<h4>question text 8</h4>
			<input type="radio" name="question-8" value="1" checked> 1 <br>
			<input type="radio" name="question-8" value="2"> 2 <br>
			<input type="radio" name="question-8" value="3"> 3 <br>
			<input type="radio" name="question-8" value="4"> 4 <br>
			<input type="radio" name="question-8" value="5"> 5 <br>

			<h2>Question 9</h2>
			<h4>question text 9</h4>
			<input type="radio" name="question-9" value="1" checked> 1 <br>
			<input type="radio" name="question-9" value="2"> 2 <br>
			<input type="radio" name="question-9" value="3"> 3 <br>
			<input type="radio" name="question-9" value="4"> 4 <br>
			<input type="radio" name="question-9" value="5"> 5 <br>

			<h2>Question 10</h2>
			<h4>question text 10</h4>
			<input type="radio" name="question-10" value="1" checked> 1 <br>
			<input type="radio" name="question-10" value="2"> 2 <br>
			<input type="radio" name="question-10" value="3"> 3 <br>
			<input type="radio" name="question-10" value="4"> 4 <br>
			<input type="radio" name="question-10" value="5"> 5 <br>
			
			<br>
			<button type="submit" class="btn btn-primary btn-md btn-block" id="submit" data-toggle="modal" data-target="#resultModal"> Submit</button>
		</form>

		<!-- Modal -->
		<div class="modal fade" id="resultModal" tabindex="-1" role="dialog" aria-labelledby="resultModalLabel" aria-hidden="true">
		  <div class="modal-dialog" role="document">
		    <div class="modal-content">
		      <div class="modal-header">
		        <h3 class="modal-title" id="resultModalLabel">Survey submitted!</h3>
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		          <span aria-hidden="true">&times;</span>
		        </button>
		      </div>
		      <div class="modal-body">
		        <p>Friend name: <span id="disp-name"></span></p>
		        <p>Friend photo: <img id="disp-photo" src="" alt="user photo"></p>
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
		      </div>
		    </div>
		  </div>
		</div>
	</div>
<script type="text/javascript">
	$("#submit").on("click", function(event) {
	    event.preventDefault();
	    var newFriend = {
	        name: $("#name").val().trim(),
	        photo: $("#photo").val().trim(),
	        scores: [
	            $("input[name=question-1]:checked").val(),
	            $("input[name=question-2]:checked").val(),
	            $("input[name=question-3]:checked").val(),
	            $("input[name=question-4]:checked").val(),
	            $("input[name=question-5]:checked").val(),
	            $("input[name=question-6]:checked").val(),
	            $("input[name=question-7]:checked").val(),
	            $("input[name=question-8]:checked").val(),
	            $("input[name=question-9]:checked").val(),
	            $("input[name=question-10]:checked").val()
	        ]
	    };
	    $.post("/api/new", newFriend)
	        .done(function(data) {
	            // console.log(data);
	            var matchData = findFriend(newFriend);
	            // alert("Submitting data...");
	        });
	});

	function findFriend(userObj) {
		// call api to get friends
		var minDiff = 100;
		var diffObj = {
			minDiff: minDiff,
			minName: "",
			minPhoto: ""
		};
		var userScores = userObj.scores;
		$.get("api/friends")
			.done(function(data) {
				for (var i = 0; i < data.length; i++) {
					if (userObj.name !== data[i].name) {
						var totalDiff = 0;
						var dataScores = data[i].scores;
						for (var j = 0; j < dataScores.length; j++) {
							totalDiff = totalDiff + Math.abs(parseFloat(dataScores[j]) - parseFloat(userScores[j]));
						}
						console.log("totalDiff", totalDiff);
						if(totalDiff < diffObj.minDiff) {
							diffObj.minDiff = totalDiff;
							diffObj.minName = data[i].name;
							diffObj.minPhoto = data[i].photo;
						}
					}
				}
				console.log("diffObj", diffObj);
				$("#disp-name").text(diffObj.minName);
				$("#disp-photo").attr("src", diffObj.minPhoto);
			return diffObj;
			});
	}
</script>

</body>
</html>